<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CragAnatomy ‚Äî Learn While You Climb</title>
    <meta name="description" content="Study climbing-relevant anatomy during your rest periods.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Newsreader:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F6F3;
            --bg-warm: #FDF9F3;
            --surface: #FFFFFF;
            --text: #2D2A26;
            --text-secondary: #5C5752;
            --text-muted: #8A8580;
            --coral: #E8927C;
            --coral-soft: #FAE8E4;
            --sage: #7BA38F;
            --sage-soft: #E4F0E8;
            --sand: #D4C4A8;
            --sand-soft: #F5F0E6;
            --sky: #8BAEC4;
            --sky-soft: #E4EEF4;
            --shadow-soft: 0 4px 20px rgba(45, 42, 38, 0.06);
            --shadow-medium: 0 8px 32px rgba(45, 42, 38, 0.1);
            --radius: 24px;
            --radius-lg: 32px;
            --radius-sm: 16px;
            --sans: 'Space Grotesk', system-ui, sans-serif;
            --serif: 'Newsreader', Georgia, serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            height: 100%;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            background: var(--bg-warm);
        }

        /* Organic blobs */
        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.4;
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }

        .blob-1 {
            width: 300px;
            height: 300px;
            background: var(--coral-soft);
            top: -100px;
            right: -100px;
        }

        .blob-2 {
            width: 250px;
            height: 250px;
            background: var(--sage-soft);
            bottom: 20%;
            left: -80px;
            animation-delay: -7s;
        }

        .blob-3 {
            width: 200px;
            height: 200px;
            background: var(--sky-soft);
            bottom: -50px;
            right: -50px;
            animation-delay: -14s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(10px, -15px) scale(1.02); }
            50% { transform: translate(-5px, 10px) scale(0.98); }
            75% { transform: translate(-15px, -5px) scale(1.01); }
        }

        /* Views */
        .view {
            position: absolute;
            inset: 0;
            display: none;
            flex-direction: column;
            opacity: 0;
            transform: translateY(16px);
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: 1;
        }

        .view.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
            z-index: 10;
        }

        /* Header */
        .header {
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .logo {
            font-family: var(--serif);
            font-size: 22px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .logo span {
            color: var(--coral);
        }

        .session-pill {
            background: var(--surface);
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            box-shadow: var(--shadow-soft);
        }

        .session-pill strong {
            color: var(--coral);
        }

        /* Home View */
        .home-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0 20px 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .hero-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 32px 0;
            min-height: 300px;
        }

        .hero-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--coral-soft) 0%, var(--sand-soft) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 40px;
            box-shadow: var(--shadow-soft);
        }

        .hero-title {
            font-family: var(--serif);
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .hero-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
            max-width: 260px;
        }

        .climb-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--coral) 0%, #D4765F 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(232, 146, 124, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 16px;
            flex-shrink: 0;
        }

        .climb-btn:active {
            transform: scale(0.98);
        }

        .next-card {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 16px;
            box-shadow: var(--shadow-soft);
            flex-shrink: 0;
        }

        .next-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .next-muscle {
            font-family: var(--serif);
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .next-region {
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* Pre-Climb View */
        .preclimb-view {
            background: var(--bg-warm);
        }

        .preclimb-header {
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            background: var(--surface);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-soft);
            font-size: 18px;
            flex-shrink: 0;
        }

        .preclimb-title-bar {
            flex: 1;
        }

        .preclimb-title-bar h1 {
            font-family: var(--serif);
            font-size: 20px;
            font-weight: 500;
            line-height: 1.2;
        }

        .preclimb-title-bar p {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        .preclimb-scroll {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 20px;
        }

        .anatomy-image-wrap {
            background: linear-gradient(135deg, #f0ede8 0%, #e5e0d8 100%);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .anatomy-image {
            max-width: 100%;
            max-height: 180px;
            object-fit: contain;
            border-radius: var(--radius-sm);
        }

        .cue-card {
            background: linear-gradient(135deg, var(--sage-soft) 0%, #D8EBE0 100%);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
        }

        .cue-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .cue-icon {
            width: 32px;
            height: 32px;
            background: var(--sage);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .cue-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--sage);
        }

        .cue-text {
            font-size: 15px;
            line-height: 1.5;
            color: var(--text);
        }

        .cue-text strong {
            color: var(--sage);
        }

        .info-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-pill {
            flex: 1;
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 14px;
            box-shadow: var(--shadow-soft);
        }

        .pill-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .pill-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }

        .preclimb-footer {
            padding: 16px 20px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            display: flex;
            gap: 12px;
            flex-shrink: 0;
            background: var(--bg-warm);
        }

        .finish-btn {
            flex: 1;
            padding: 18px;
            background: linear-gradient(135deg, var(--sage) 0%, #5E8A72 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(123, 163, 143, 0.35);
        }

        .finish-btn:active {
            transform: scale(0.98);
        }

        .rest-btn {
            padding: 18px 24px;
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--sage);
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .rest-btn:active {
            background: var(--sage-soft);
        }

        /* Rest View */
        .rest-header {
            background: linear-gradient(135deg, var(--sage-soft) 0%, #D8EBE0 100%);
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .rest-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rest-dot {
            width: 10px;
            height: 10px;
            background: var(--sage);
            border-radius: 50%;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.15); }
        }

        .rest-label {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--sage);
        }

        .rest-timer {
            font-size: 22px;
            font-weight: 700;
            color: var(--sage);
            font-variant-numeric: tabular-nums;
        }

        .rest-scroll {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .rest-image-wrap {
            background: linear-gradient(135deg, #f0ede8 0%, #e5e0d8 100%);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rest-image {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-medium);
        }

        .image-credit {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 10px;
        }

        .rest-details {
            padding: 20px;
        }

        .rest-title {
            font-family: var(--serif);
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .rest-latin {
            font-family: var(--serif);
            font-style: italic;
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 20px;
        }

        .detail-section {
            margin-bottom: 16px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .section-icon {
            font-size: 14px;
        }

        .section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 700;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .detail-card {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 14px;
            box-shadow: var(--shadow-soft);
        }

        .detail-card.full {
            grid-column: 1 / -1;
        }

        .detail-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 13px;
            color: var(--text);
            line-height: 1.45;
        }

        .highlight-card {
            background: linear-gradient(135deg, var(--coral-soft) 0%, #FCE4DF 100%);
            border-radius: var(--radius-sm);
            padding: 16px;
        }

        .highlight-card .detail-label {
            color: var(--coral);
        }

        .clinical-card {
            background: linear-gradient(135deg, var(--sky-soft) 0%, #D6E8F2 100%);
            border-radius: var(--radius-sm);
            padding: 16px;
        }

        .clinical-card .detail-label {
            color: var(--sky);
        }

        .rest-footer {
            padding: 16px 20px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            background: var(--bg-warm);
            border-top: 1px solid rgba(0,0,0,0.05);
            flex-shrink: 0;
        }

        .next-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--coral) 0%, #D4765F 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(232, 146, 124, 0.35);
        }

        .next-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>

        <!-- Home View -->
        <div class="view active" id="view-home">
            <header class="header">
                <div class="logo">Crag<span>Anatomy</span></div>
                <div class="session-pill">üßó Climbs: <strong id="climb-count">0</strong></div>
            </header>
            
            <div class="home-content">
                <div class="hero-section">
                    <div class="hero-icon">ü¶¥</div>
                    <h1 class="hero-title">Ready to Climb?</h1>
                    <p class="hero-subtitle">Learn climbing anatomy during your rest periods.</p>
                </div>
                
                <button class="climb-btn" onclick="app.startClimb()">
                    Start Climb ‚Üí
                </button>
                
                <div class="next-card">
                    <div class="next-label">Next Focus</div>
                    <div class="next-muscle" id="next-muscle">Loading...</div>
                    <div class="next-region" id="next-region"></div>
                </div>
            </div>
        </div>

        <!-- Pre-Climb View -->
        <div class="view" id="view-preclimb">
            <div class="preclimb-header">
                <button class="back-btn" onclick="app.goHome()">‚Üê</button>
                <div class="preclimb-title-bar">
                    <h1 id="preclimb-title"></h1>
                    <p id="preclimb-latin"></p>
                </div>
            </div>
            
            <div class="preclimb-scroll">
                <div class="anatomy-image-wrap">
                    <img id="preclimb-image" class="anatomy-image" src="" alt="Anatomy">
                </div>
                
                <div class="cue-card">
                    <div class="cue-header">
                        <div class="cue-icon">üí°</div>
                        <span class="cue-label">While You Climb</span>
                    </div>
                    <p class="cue-text" id="preclimb-cue"></p>
                </div>
                
                <div class="info-row">
                    <div class="info-pill">
                        <div class="pill-label">Action</div>
                        <div class="pill-value" id="preclimb-action"></div>
                    </div>
                    <div class="info-pill">
                        <div class="pill-label">Region</div>
                        <div class="pill-value" id="preclimb-region"></div>
                    </div>
                </div>
            </div>
            
            <div class="preclimb-footer">
                <button class="rest-btn" onclick="app.skipToRest()">Rest</button>
                <button class="finish-btn" onclick="app.finishClimb()">‚úì Done Climbing</button>
            </div>
        </div>

        <!-- Rest View -->
        <div class="view" id="view-rest">
            <div class="rest-header">
                <div class="rest-status">
                    <div class="rest-dot"></div>
                    <span class="rest-label">Rest & Learn</span>
                </div>
                <div class="rest-timer" id="rest-timer">0:00</div>
            </div>
            
            <div class="rest-scroll">
                <div class="rest-image-wrap">
                    <img id="rest-image" class="rest-image" src="" alt="Anatomy">
                    <div class="image-credit" id="image-credit"></div>
                </div>
                
                <div class="rest-details">
                    <h2 class="rest-title" id="rest-title"></h2>
                    <p class="rest-latin" id="rest-latin"></p>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">üìç</span>
                            <span class="section-title">Attachments</span>
                        </div>
                        <div class="detail-grid">
                            <div class="detail-card">
                                <div class="detail-label">Origin</div>
                                <div class="detail-value" id="rest-origin"></div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Insertion</div>
                                <div class="detail-value" id="rest-insertion"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">‚ö°</span>
                            <span class="section-title">Innervation</span>
                        </div>
                        <div class="detail-grid">
                            <div class="detail-card">
                                <div class="detail-label">Nerve</div>
                                <div class="detail-value" id="rest-nerve"></div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Artery</div>
                                <div class="detail-value" id="rest-artery"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">üéØ</span>
                            <span class="section-title">Function</span>
                        </div>
                        <div class="detail-card full">
                            <div class="detail-label">Actions</div>
                            <div class="detail-value" id="rest-actions"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">üßó</span>
                            <span class="section-title">Climbing Application</span>
                        </div>
                        <div class="highlight-card">
                            <div class="detail-label">Why Climbers Care</div>
                            <div class="detail-value" id="rest-climbing"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">‚ö†Ô∏è</span>
                            <span class="section-title">Clinical Note</span>
                        </div>
                        <div class="clinical-card">
                            <div class="detail-label">Common Injury</div>
                            <div class="detail-value" id="rest-clinical"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="rest-footer">
                <button class="next-btn" onclick="app.nextClimb()">üßó Next Climb</button>
            </div>
        </div>
    </div>

    <script>
    // Anatomy database with verified working image URLs
    const ANATOMY_DB = [
        {
            id: 'fdp',
            name: 'Flexor Digitorum Profundus',
            latin: 'Musculus flexor digitorum profundus',
            region: 'Forearm',
            origin: 'Proximal 3/4 of anterior ulna, interosseous membrane',
            insertion: 'Bases of distal phalanges, digits 2-5',
            nerve: 'Median (digits 2-3), Ulnar (digits 4-5)',
            artery: 'Anterior interosseous artery',
            actions: 'Flexes DIP joints. Only muscle that can flex your fingertips.',
            climbingCue: 'Pay attention to <strong>FDP when crimping</strong>. Feel the deep forearm burn as you curl your fingertips on edges. This is your primary crimp muscle.',
            climbingDetail: 'The engine of the crimp. When you curl your fingertips on a hold, FDP does the heavy lifting. Also gives rise to lumbrical muscles.',
            clinical: 'Lumbrical shift syndrome: sharp palm pain when pulling hard on 1-2 fingers in pockets.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Flexor_digitorum_profundus_muscle.png/250px-Flexor_digitorum_profundus_muscle.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'fds',
            name: 'Flexor Digitorum Superficialis',
            latin: 'Musculus flexor digitorum superficialis',
            region: 'Forearm',
            origin: 'Medial epicondyle, coronoid process, radius',
            insertion: 'Sides of middle phalanges, digits 2-5',
            nerve: 'Median nerve (C7, C8, T1)',
            artery: 'Ulnar and radial arteries',
            actions: 'Flexes PIP joints. Assists MCP and wrist flexion.',
            climbingCue: 'Pay attention to <strong>FDS on slopers and open-hand grips</strong>. When you curve your middle knuckles without crimping, FDS is the prime mover.',
            climbingDetail: 'Works with FDP for grip strength. Takes more load on slopers and larger holds where you use open-hand position.',
            clinical: 'FDS tenosynovitis can cause trigger finger. Test by holding other fingers extended while flexing one PIP.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Flexor_digitorum_superficialis_muscle.png/250px-Flexor_digitorum_superficialis_muscle.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'lat',
            name: 'Latissimus Dorsi',
            latin: 'Musculus latissimus dorsi',
            region: 'Back',
            origin: 'T7-L5 spinous processes, thoracolumbar fascia, iliac crest',
            insertion: 'Intertubercular groove of humerus',
            nerve: 'Thoracodorsal nerve (C6-C8)',
            artery: 'Thoracodorsal artery',
            actions: 'Extension, adduction, medial rotation of arm.',
            climbingCue: 'Pay attention to <strong>lat engagement on every pull-down</strong>. Initiate pulls by depressing your shoulder. Feel the connection from hands to hips on steep terrain.',
            climbingDetail: 'The primary pulling muscle. Every pull-down engages the lats. On overhangs, they work overtime. Strong lats reduce load on smaller structures.',
            clinical: 'Tight lats limit overhead mobility and can cause shoulder impingement or lumbar hyperextension.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Latissimus_dorsi_muscle_back.png/250px-Latissimus_dorsi_muscle_back.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'brachialis',
            name: 'Brachialis',
            latin: 'Musculus brachialis',
            region: 'Arm',
            origin: 'Distal half of anterior humerus',
            insertion: 'Coronoid process of ulna',
            nerve: 'Musculocutaneous nerve (C5, C6)',
            artery: 'Brachial artery',
            actions: 'Primary elbow flexor regardless of forearm position.',
            climbingCue: 'Pay attention to <strong>brachialis during lock-offs</strong>. Unlike biceps, it works equally whether palms are up, down, or neutral. Feel the deep anterior arm burn.',
            climbingDetail: 'More important than biceps for climbing! Pure elbow flexor that works in any position. Every lock-off and pull-up relies heavily on brachialis.',
            clinical: 'Brachialis tendinopathy causes deep anterior elbow pain, often misdiagnosed as biceps issues.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Brachialis_muscle01.png/250px-Brachialis_muscle01.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'biceps',
            name: 'Biceps Brachii',
            latin: 'Musculus biceps brachii',
            region: 'Arm',
            origin: 'Supraglenoid tubercle (long), coracoid process (short)',
            insertion: 'Radial tuberosity',
            nerve: 'Musculocutaneous nerve (C5, C6)',
            artery: 'Brachial artery',
            actions: 'Supination (strongest), elbow flexion, assists shoulder flexion.',
            climbingCue: 'Pay attention to <strong>biceps on sidepulls and underlings</strong>. Biceps is your strongest supinator. Feel it fire when you twist your palm up.',
            climbingDetail: 'Secondary to brachialis for pure flexion, but crucial for supination on sidepulls and underlings where forearm rotation matters.',
            clinical: 'Long head tendinopathy: anterior shoulder pain with overhead reaching. "Popeye deformity" = rupture.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Biceps_brachii_muscle01.png/250px-Biceps_brachii_muscle01.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'supraspinatus',
            name: 'Supraspinatus',
            latin: 'Musculus supraspinatus',
            region: 'Shoulder',
            origin: 'Supraspinous fossa of scapula',
            insertion: 'Greater tubercle of humerus',
            nerve: 'Suprascapular nerve (C5, C6)',
            artery: 'Suprascapular artery',
            actions: 'Initiates abduction (first 15¬∞), stabilizes shoulder.',
            climbingCue: 'Pay attention to <strong>supraspinatus when initiating reaches</strong>. It fires to start every reach and keeps your humeral head centered during dynamic moves.',
            climbingDetail: 'Critical for dynamic moves and shoulder stability. Tendon passes through subacromial space - vulnerable to impingement with poor mechanics.',
            clinical: 'Most commonly torn rotator cuff muscle. "Empty can test" for assessment.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/Supraspinatus_muscle_top.png/250px-Supraspinatus_muscle_top.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'infraspinatus',
            name: 'Infraspinatus',
            latin: 'Musculus infraspinatus',
            region: 'Shoulder',
            origin: 'Infraspinous fossa of scapula',
            insertion: 'Greater tubercle of humerus',
            nerve: 'Suprascapular nerve (C5, C6)',
            artery: 'Suprascapular artery',
            actions: 'External rotation of arm, stabilizes shoulder.',
            climbingCue: 'Pay attention to <strong>infraspinatus during gastons</strong>. When you push outward on a sidepull, external rotation engages infraspinatus. Also decelerates dynamic moves.',
            climbingDetail: 'Essential for gastons and external rotation moves. Often weak and overpowered by internal rotators in climbers.',
            clinical: 'Spinoglenoid notch cysts can selectively affect infraspinatus while sparing supraspinatus.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c0/Infraspinatus_muscle_back.png/250px-Infraspinatus_muscle_back.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'trapezius',
            name: 'Trapezius',
            latin: 'Musculus trapezius',
            region: 'Back/Neck',
            origin: 'Skull base, ligamentum nuchae, C7-T12 spinous processes',
            insertion: 'Clavicle, acromion, spine of scapula',
            nerve: 'Spinal accessory (CN XI)',
            artery: 'Transverse cervical artery',
            actions: 'Upper: elevates. Middle: retracts. Lower: depresses scapula.',
            climbingCue: 'Pay attention to <strong>upper vs lower trap when reaching high</strong>. Avoid shrugging! Keep shoulders down by engaging lower trap. Upper trap is often overactive.',
            climbingDetail: 'Upper trap often overactive in climbers. Lower trap is crucial for keeping shoulders down during hangs and overhead reaches.',
            clinical: 'CN XI damage causes shoulder droop and difficulty raising arm above horizontal.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Trapezius_Gray409.PNG/250px-Trapezius_Gray409.PNG',
            imageCredit: 'Gray\'s Anatomy'
        },
        {
            id: 'rhomboids',
            name: 'Rhomboid Major & Minor',
            latin: 'Musculi rhomboidei',
            region: 'Back',
            origin: 'C7-T5 spinous processes',
            insertion: 'Medial border of scapula',
            nerve: 'Dorsal scapular nerve (C5)',
            artery: 'Dorsal scapular artery',
            actions: 'Retraction of scapula, elevation, downward rotation.',
            climbingCue: 'Pay attention to <strong>rhomboids when squeezing shoulder blades together</strong>. At the bottom of a pull or during lock-offs, feel the squeeze between spine and scapulae.',
            climbingDetail: 'Critical for scapular stability and proper pulling mechanics. Weak rhomboids lead to winged scapulae and poor force transfer.',
            clinical: 'Dorsal scapular nerve entrapment causes medial scapular pain, often misdiagnosed as cervical radiculopathy.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Rhomboideus_major_muscle_back.png/250px-Rhomboideus_major_muscle_back.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'serratus',
            name: 'Serratus Anterior',
            latin: 'Musculus serratus anterior',
            region: 'Thorax',
            origin: 'Ribs 1-8 lateral surfaces',
            insertion: 'Medial border of scapula (anterior)',
            nerve: 'Long thoracic nerve (C5-C7)',
            artery: 'Lateral thoracic artery',
            actions: 'Protracts scapula, upward rotation, holds scapula to thorax.',
            climbingCue: 'Pay attention to <strong>serratus when reaching far or mantling</strong>. Feel the lateral rib activation as you push your scapula forward. Essential for pressing out.',
            climbingDetail: 'Essential for overhead reaching and pressing movements like mantling. Works with trapezius for upward rotation.',
            clinical: 'Long thoracic nerve damage causes classic winged scapula when pushing against a wall.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Serratus_anterior_muscle_lateral.png/250px-Serratus_anterior_muscle_lateral.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'triceps',
            name: 'Triceps Brachii',
            latin: 'Musculus triceps brachii',
            region: 'Arm',
            origin: 'Infraglenoid tubercle (long), posterior humerus (lat/med)',
            insertion: 'Olecranon of ulna',
            nerve: 'Radial nerve (C6-C8)',
            artery: 'Deep brachial artery',
            actions: 'Elbow extension. Long head assists shoulder extension.',
            climbingCue: 'Pay attention to <strong>triceps during mantles and press moves</strong>. When you push down to top out, triceps extends your elbow. Feel the posterior arm engagement.',
            climbingDetail: 'Essential for mantling, press moves, and controlled descent. Long head assists lats in shoulder extension.',
            clinical: 'Radial nerve in spiral groove vulnerable to midshaft humeral fractures - causing wrist drop.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Triceps_brachii_muscle07.png/250px-Triceps_brachii_muscle07.png',
            imageCredit: 'Wikimedia Commons'
        },
        {
            id: 'subscapularis',
            name: 'Subscapularis',
            latin: 'Musculus subscapularis',
            region: 'Shoulder',
            origin: 'Subscapular fossa (anterior scapula)',
            insertion: 'Lesser tubercle of humerus',
            nerve: 'Subscapular nerves (C5-C7)',
            artery: 'Subscapular artery',
            actions: 'Internal rotation, adduction, anterior GH stabilization.',
            climbingCue: 'Pay attention to <strong>subscapularis during cross-body moves</strong>. Internal rotation power comes from subscap. It prevents anterior shoulder dislocation.',
            climbingDetail: 'Largest rotator cuff muscle. Provides anterior stability and powers internal rotation. Often tight in climbers.',
            clinical: 'Tested with lift-off test. Tears cause internal rotation weakness and anterior instability.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Subscapularis_muscle_frontal.png/250px-Subscapularis_muscle_frontal.png',
            imageCredit: 'Wikimedia Commons'
        }
    ];

    const app = {
        state: {
            currentIndex: 0,
            climbCount: 0,
            timerInterval: null,
            timerSeconds: 0,
            history: []
        },

        init() {
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
        },

        getRandomIndex() {
            const available = [];
            for (let i = 0; i < ANATOMY_DB.length; i++) {
                if (!this.state.history.slice(-3).includes(i)) {
                    available.push(i);
                }
            }
            if (available.length === 0) {
                return Math.floor(Math.random() * ANATOMY_DB.length);
            }
            return available[Math.floor(Math.random() * available.length)];
        },

        updateNextPreview() {
            const item = ANATOMY_DB[this.state.currentIndex];
            document.getElementById('next-muscle').textContent = item.name;
            document.getElementById('next-region').textContent = item.region;
        },

        showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        },

        startClimb() {
            const item = ANATOMY_DB[this.state.currentIndex];
            
            document.getElementById('preclimb-image').src = item.image;
            document.getElementById('preclimb-title').textContent = item.name;
            document.getElementById('preclimb-latin').textContent = item.latin;
            document.getElementById('preclimb-action').textContent = item.actions.split('.')[0];
            document.getElementById('preclimb-region').textContent = item.region;
            document.getElementById('preclimb-cue').innerHTML = item.climbingCue;
            
            this.showView('view-preclimb');
        },

        finishClimb() {
            this.populateRestView();
            this.startTimer();
            this.state.climbCount++;
            this.state.history.push(this.state.currentIndex);
            document.getElementById('climb-count').textContent = this.state.climbCount;
            this.showView('view-rest');
        },

        skipToRest() {
            this.populateRestView();
            this.startTimer();
            this.showView('view-rest');
        },

        populateRestView() {
            const item = ANATOMY_DB[this.state.currentIndex];
            
            document.getElementById('rest-image').src = item.image;
            document.getElementById('rest-title').textContent = item.name;
            document.getElementById('rest-latin').textContent = item.latin;
            document.getElementById('rest-origin').textContent = item.origin;
            document.getElementById('rest-insertion').textContent = item.insertion;
            document.getElementById('rest-nerve').textContent = item.nerve;
            document.getElementById('rest-artery').textContent = item.artery;
            document.getElementById('rest-actions').textContent = item.actions;
            document.getElementById('rest-climbing').textContent = item.climbingDetail;
            document.getElementById('rest-clinical').textContent = item.clinical;
            document.getElementById('image-credit').textContent = item.imageCredit;
        },

        startTimer() {
            this.state.timerSeconds = 0;
            this.updateTimerDisplay();
            if (this.state.timerInterval) clearInterval(this.state.timerInterval);
            this.state.timerInterval = setInterval(() => {
                this.state.timerSeconds++;
                this.updateTimerDisplay();
            }, 1000);
        },

        updateTimerDisplay() {
            const mins = Math.floor(this.state.timerSeconds / 60);
            const secs = this.state.timerSeconds % 60;
            document.getElementById('rest-timer').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        },

        stopTimer() {
            if (this.state.timerInterval) {
                clearInterval(this.state.timerInterval);
                this.state.timerInterval = null;
            }
        },

        nextClimb() {
            this.stopTimer();
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
            this.startClimb();
        },

        goHome() {
            this.stopTimer();
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
            this.showView('view-home');
        }
    };

    document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
