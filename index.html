<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CragAnatomy</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Newsreader:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F6F3;
            --bg-warm: #FDF9F3;
            --surface: #FFFFFF;
            --text: #2D2A26;
            --text-secondary: #5C5752;
            --text-muted: #8A8580;
            --coral: #E8927C;
            --coral-soft: #FAE8E4;
            --sage: #7BA38F;
            --sage-soft: #E4F0E8;
            --sand: #D4C4A8;
            --sand-soft: #F5F0E6;
            --sky: #8BAEC4;
            --sky-soft: #E4EEF4;
            --shadow-soft: 0 4px 20px rgba(45, 42, 38, 0.06);
            --radius: 24px;
            --radius-sm: 16px;
            --sans: 'Space Grotesk', system-ui, sans-serif;
            --serif: 'Newsreader', Georgia, serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            height: 100%;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            background: var(--bg-warm);
        }

        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.4;
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }
        .blob-1 { width: 300px; height: 300px; background: var(--coral-soft); top: -100px; right: -100px; }
        .blob-2 { width: 250px; height: 250px; background: var(--sage-soft); bottom: 20%; left: -80px; animation-delay: -7s; }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-10px, 10px); }
        }

        .view {
            position: absolute;
            inset: 0;
            display: none;
            flex-direction: column;
            z-index: 1;
        }
        .view.active { display: flex; z-index: 10; }

        .header {
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .logo {
            font-family: var(--serif);
            font-size: 22px;
            font-weight: 600;
        }
        .logo span { color: var(--coral); }

        .session-pill {
            background: var(--surface);
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            box-shadow: var(--shadow-soft);
        }
        .session-pill strong { color: var(--coral); }

        .home-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0 20px 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .hero-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 32px 0;
        }

        .hero-icon {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-soft);
            overflow: hidden;
        }
        
        .hero-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .hero-title {
            font-family: var(--serif);
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .hero-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
            max-width: 260px;
        }

        .climb-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--coral) 0%, #D4765F 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(232, 146, 124, 0.35);
            margin-bottom: 16px;
            flex-shrink: 0;
        }
        .climb-btn:active { transform: scale(0.98); }

        .next-card {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 16px;
            box-shadow: var(--shadow-soft);
            flex-shrink: 0;
        }

        .next-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .next-muscle {
            font-family: var(--serif);
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .next-region {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .preclimb-header {
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            background: var(--surface);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-soft);
            font-size: 18px;
        }

        .preclimb-title-bar { flex: 1; }
        .preclimb-title-bar h1 {
            font-family: var(--serif);
            font-size: 20px;
            font-weight: 500;
            line-height: 1.2;
        }
        .preclimb-title-bar p {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        .preclimb-scroll {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 20px;
        }

        .anatomy-visual {
            background: linear-gradient(135deg, #f0ede8 0%, #e5e0d8 100%);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .anatomy-visual img {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 12px;
        }

        .cue-card {
            background: linear-gradient(135deg, var(--sage-soft) 0%, #D8EBE0 100%);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
        }

        .cue-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .cue-icon {
            width: 32px;
            height: 32px;
            background: var(--sage);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .cue-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--sage);
        }

        .cue-text {
            font-size: 15px;
            line-height: 1.5;
            color: var(--text);
        }
        .cue-text strong { color: var(--sage); }

        .info-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-pill {
            flex: 1;
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 14px;
            box-shadow: var(--shadow-soft);
        }

        .pill-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .pill-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }

        .preclimb-footer {
            padding: 16px 20px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            display: flex;
            gap: 12px;
            flex-shrink: 0;
        }

        .finish-btn {
            flex: 1;
            padding: 18px;
            background: linear-gradient(135deg, var(--sage) 0%, #5E8A72 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(123, 163, 143, 0.35);
        }
        .finish-btn:active { transform: scale(0.98); }

        .rest-btn {
            padding: 18px 24px;
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--sage);
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .rest-btn:active { background: var(--sage-soft); }

        .rest-header {
            background: linear-gradient(135deg, var(--sage-soft) 0%, #D8EBE0 100%);
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .rest-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rest-dot {
            width: 10px;
            height: 10px;
            background: var(--sage);
            border-radius: 50%;
            animation: pulse 2s ease infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .rest-label {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--sage);
        }

        .rest-timer {
            font-size: 22px;
            font-weight: 700;
            color: var(--sage);
        }

        .rest-scroll {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .rest-visual {
            background: linear-gradient(135deg, #f0ede8 0%, #e5e0d8 100%);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rest-visual img {
            max-width: 100%;
            max-height: 220px;
            object-fit: contain;
            border-radius: 12px;
            box-shadow: var(--shadow-soft);
        }

        .image-credit {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 8px;
            text-align: center;
        }

        .rest-details { padding: 20px; }

        .rest-title {
            font-family: var(--serif);
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .rest-latin {
            font-family: var(--serif);
            font-style: italic;
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 20px;
        }

        .detail-section { margin-bottom: 16px; }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .section-icon { font-size: 14px; }

        .section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 700;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .detail-card {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 14px;
            box-shadow: var(--shadow-soft);
        }
        .detail-card.full { grid-column: 1 / -1; }

        .detail-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 13px;
            color: var(--text);
            line-height: 1.45;
        }

        .highlight-card {
            background: linear-gradient(135deg, var(--coral-soft) 0%, #FCE4DF 100%);
            border-radius: var(--radius-sm);
            padding: 16px;
        }
        .highlight-card .detail-label { color: var(--coral); }

        .clinical-card {
            background: linear-gradient(135deg, var(--sky-soft) 0%, #D6E8F2 100%);
            border-radius: var(--radius-sm);
            padding: 16px;
        }
        .clinical-card .detail-label { color: var(--sky); }

        .rest-footer {
            padding: 16px 20px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            flex-shrink: 0;
        }

        .next-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--coral) 0%, #D4765F 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(232, 146, 124, 0.35);
        }
        .next-btn:active { transform: scale(0.98); }
    </style>
</head>
<body>
    <div class="app">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>

        <!-- Home -->
        <div class="view active" id="view-home">
            <header class="header">
                <div class="logo">Crag<span>Anatomy</span></div>
                <div class="session-pill">üßó <strong id="climb-count">0</strong></div>
            </header>
            <div class="home-content">
                <div class="hero-section">
                    <div class="hero-icon"><img src="https://media.istockphoto.com/id/485407337/photo/human-anatomy-model.jpg?s=612x612&w=0&k=20&c=xDE9nXiNdsniWdtcqHX9yErSUcfBgTMIjX-kODOFiMw=" alt="Anatomy"></div>
                    <h1 class="hero-title">Ready to Climb?</h1>
                    <p class="hero-subtitle">Learn climbing anatomy during rest periods.</p>
                </div>
                <button class="climb-btn" onclick="app.startClimb()">Start Climb ‚Üí</button>
                <div class="next-card">
                    <div class="next-label">Focus</div>
                    <div class="next-muscle" id="next-muscle">Loading...</div>
                    <div class="next-region" id="next-region"></div>
                </div>
            </div>
        </div>

        <!-- Pre-Climb -->
        <div class="view" id="view-preclimb">
            <div class="preclimb-header">
                <button class="back-btn" onclick="app.goHome()">‚Üê</button>
                <div class="preclimb-title-bar">
                    <h1 id="preclimb-title"></h1>
                    <p id="preclimb-latin"></p>
                </div>
            </div>
            <div class="preclimb-scroll">
                <div class="anatomy-visual"><img id="preclimb-image" src="" alt="Anatomy"></div>
                <div class="cue-card">
                    <div class="cue-header">
                        <div class="cue-icon">üí°</div>
                        <span class="cue-label">While You Climb</span>
                    </div>
                    <p class="cue-text" id="preclimb-cue"></p>
                </div>
                <div class="info-row">
                    <div class="info-pill">
                        <div class="pill-label">Action</div>
                        <div class="pill-value" id="preclimb-action"></div>
                    </div>
                    <div class="info-pill">
                        <div class="pill-label">Region</div>
                        <div class="pill-value" id="preclimb-region"></div>
                    </div>
                </div>
            </div>
            <div class="preclimb-footer">
                <button class="rest-btn" onclick="app.skipToRest()">Rest</button>
                <button class="finish-btn" onclick="app.finishClimb()">‚úì Done</button>
            </div>
        </div>

        <!-- Rest -->
        <div class="view" id="view-rest">
            <div class="rest-header">
                <div class="rest-status">
                    <div class="rest-dot"></div>
                    <span class="rest-label">Rest & Learn</span>
                </div>
                <div class="rest-timer" id="rest-timer">0:00</div>
            </div>
            <div class="rest-scroll">
                <div class="rest-visual">
                    <img id="rest-image" src="" alt="Anatomy">
                    <div class="image-credit" id="image-credit"></div>
                </div>
                <div class="rest-details">
                    <h2 class="rest-title" id="rest-title"></h2>
                    <p class="rest-latin" id="rest-latin"></p>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">üìç</span>
                            <span class="section-title">Attachments</span>
                        </div>
                        <div class="detail-grid">
                            <div class="detail-card">
                                <div class="detail-label">Origin</div>
                                <div class="detail-value" id="rest-origin"></div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Insertion</div>
                                <div class="detail-value" id="rest-insertion"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">‚ö°</span>
                            <span class="section-title">Innervation</span>
                        </div>
                        <div class="detail-grid">
                            <div class="detail-card">
                                <div class="detail-label">Nerve</div>
                                <div class="detail-value" id="rest-nerve"></div>
                            </div>
                            <div class="detail-card">
                                <div class="detail-label">Artery</div>
                                <div class="detail-value" id="rest-artery"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">üéØ</span>
                            <span class="section-title">Function</span>
                        </div>
                        <div class="detail-card full">
                            <div class="detail-label">Actions</div>
                            <div class="detail-value" id="rest-actions"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">üßó</span>
                            <span class="section-title">Climbing</span>
                        </div>
                        <div class="highlight-card">
                            <div class="detail-label">Why Climbers Care</div>
                            <div class="detail-value" id="rest-climbing"></div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="section-header">
                            <span class="section-icon">‚ö†Ô∏è</span>
                            <span class="section-title">Clinical</span>
                        </div>
                        <div class="clinical-card">
                            <div class="detail-label">Injury Note</div>
                            <div class="detail-value" id="rest-clinical"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="rest-footer">
                <button class="next-btn" onclick="app.nextClimb()">üßó Next Climb</button>
            </div>
        </div>
    </div>

    <script>
    // Real anatomy images from TeachMeAnatomy (verified working)
    const IMAGES = {
        forearm: 'https://teachmeanatomy.info/wp-content/uploads/Deep-Flexor-Muscles-of-the-Anterior-Forearm-1024x355.png',
        forearm_superficial: 'https://teachmeanatomy.info/wp-content/uploads/Superficial-Flexor-Muscles-of-the-Anterior-Forearm.png',
        back: 'https://teachmeanatomy.info/wp-content/uploads/Superficial-Muscles-of-the-Back-857x1024.jpg',
        arm: 'https://teachmeanatomy.info/wp-content/uploads/Coracobrachialis-Biceps-and-Brachialis-Muscles.jpg',
        triceps: 'https://teachmeanatomy.info/wp-content/uploads/Long-and-Lateral-Heads-of-the-Triceps-Brachii.jpg',
        // Using Wikimedia Commons verified working URLs for shoulder/hand
        shoulder: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Arm_muscles_front_deep.png/300px-Arm_muscles_front_deep.png',
        hand: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Hand_dissection_1.jpg/300px-Hand_dissection_1.jpg'
    };

    const ANATOMY_DB = [
        {
            id: 'fdp',
            name: 'Flexor Digitorum Profundus',
            latin: 'M. flexor digitorum profundus',
            region: 'Forearm',
            image: IMAGES.forearm,
            credit: 'TeachMeAnatomy',
            origin: 'Proximal 3/4 of anterior ulna',
            insertion: 'Bases of distal phalanges 2-5',
            nerve: 'Median (2-3), Ulnar (4-5)',
            artery: 'Anterior interosseous',
            actions: 'Flexes DIP joints - the only muscle that can flex fingertips.',
            climbingCue: 'Pay attention to <strong>FDP when crimping</strong>. Feel the deep forearm burn as you curl fingertips onto small edges.',
            climbingDetail: 'The crimp engine. When you curl fingertips on a hold, FDP does the work. Also origin for lumbricals.',
            clinical: 'Lumbrical shift: sharp palm pain in pockets when fingers load unevenly.'
        },
        {
            id: 'fds',
            name: 'Flexor Digitorum Superficialis',
            latin: 'M. flexor digitorum superficialis',
            region: 'Forearm',
            image: IMAGES.forearm_superficial,
            credit: 'TeachMeAnatomy',
            origin: 'Medial epicondyle, coronoid, radius',
            insertion: 'Sides of middle phalanges 2-5',
            nerve: 'Median nerve (C7-T1)',
            artery: 'Ulnar and radial arteries',
            actions: 'Flexes PIP joints. Assists MCP and wrist flexion.',
            climbingCue: 'Pay attention to <strong>FDS on slopers</strong>. When you curve middle knuckles without crimping, FDS is prime mover.',
            climbingDetail: 'Works with FDP for grip. Takes more load on slopers and open-hand positions.',
            clinical: 'FDS tenosynovitis can cause trigger finger.'
        },
        {
            id: 'lat',
            name: 'Latissimus Dorsi',
            latin: 'M. latissimus dorsi',
            region: 'Back',
            image: IMAGES.back,
            credit: 'TeachMeAnatomy',
            origin: 'T7-L5 spinous processes, thoracolumbar fascia, iliac crest',
            insertion: 'Intertubercular groove of humerus',
            nerve: 'Thoracodorsal (C6-C8)',
            artery: 'Thoracodorsal artery',
            actions: 'Extension, adduction, medial rotation of arm.',
            climbingCue: 'Pay attention to <strong>lat engagement on every pull</strong>. Initiate by depressing shoulder. Feel hands-to-hips connection.',
            climbingDetail: 'Primary pulling muscle. Every pull-down engages lats. Strong lats reduce load on smaller structures.',
            clinical: 'Tight lats limit overhead mobility, cause shoulder impingement.'
        },
        {
            id: 'brachialis',
            name: 'Brachialis',
            latin: 'M. brachialis',
            region: 'Arm',
            image: IMAGES.arm,
            credit: 'TeachMeAnatomy',
            origin: 'Distal half of anterior humerus',
            insertion: 'Coronoid process of ulna',
            nerve: 'Musculocutaneous (C5-C6)',
            artery: 'Brachial artery',
            actions: 'Primary elbow flexor - works regardless of forearm position.',
            climbingCue: 'Pay attention to <strong>brachialis during lock-offs</strong>. Works equally palms up, down, or neutral. Feel deep anterior arm burn.',
            climbingDetail: 'More important than biceps! Pure elbow flexor in any position. Every lock-off relies on brachialis.',
            clinical: 'Brachialis tendinopathy: deep anterior elbow pain, often misdiagnosed as biceps.'
        },
        {
            id: 'biceps',
            name: 'Biceps Brachii',
            latin: 'M. biceps brachii',
            region: 'Arm',
            image: IMAGES.arm,
            credit: 'TeachMeAnatomy',
            origin: 'Supraglenoid tubercle & coracoid process',
            insertion: 'Radial tuberosity',
            nerve: 'Musculocutaneous (C5-C6)',
            artery: 'Brachial artery',
            actions: 'Supination (strongest), elbow flexion.',
            climbingCue: 'Pay attention to <strong>biceps on sidepulls and underlings</strong>. Strongest supinator - feel it when you twist palm up.',
            climbingDetail: 'Secondary to brachialis for flexion, but crucial for supination on sidepulls.',
            clinical: 'Long head tendinopathy: anterior shoulder pain. "Popeye deformity" = rupture.'
        },
        {
            id: 'supraspinatus',
            name: 'Supraspinatus',
            latin: 'M. supraspinatus',
            region: 'Shoulder',
            image: IMAGES.shoulder,
            credit: 'Wikimedia Commons',
            origin: 'Supraspinous fossa',
            insertion: 'Greater tubercle of humerus',
            nerve: 'Suprascapular (C5-C6)',
            artery: 'Suprascapular artery',
            actions: 'Initiates abduction (first 15¬∞), stabilizes shoulder.',
            climbingCue: 'Pay attention to <strong>supraspinatus when initiating reaches</strong>. Fires to start every reach, keeps shoulder stable.',
            climbingDetail: 'Critical for dynamic moves. Tendon vulnerable to impingement with poor mechanics.',
            clinical: 'Most commonly torn rotator cuff muscle. "Empty can test" for assessment.'
        },
        {
            id: 'infraspinatus',
            name: 'Infraspinatus',
            latin: 'M. infraspinatus',
            region: 'Shoulder',
            image: IMAGES.back,
            credit: 'TeachMeAnatomy',
            origin: 'Infraspinous fossa',
            insertion: 'Greater tubercle of humerus',
            nerve: 'Suprascapular (C5-C6)',
            artery: 'Suprascapular artery',
            actions: 'External rotation, stabilizes shoulder.',
            climbingCue: 'Pay attention to <strong>infraspinatus during gastons</strong>. External rotation engages it. Also decelerates dynamic moves.',
            climbingDetail: 'Essential for gastons. Often weak and overpowered by internal rotators in climbers.',
            clinical: 'Spinoglenoid cysts can selectively affect infraspinatus.'
        },
        {
            id: 'trapezius',
            name: 'Trapezius',
            latin: 'M. trapezius',
            region: 'Back',
            image: IMAGES.back,
            credit: 'TeachMeAnatomy',
            origin: 'Skull base, C7-T12 spinous processes',
            insertion: 'Clavicle, acromion, scapular spine',
            nerve: 'Spinal accessory (CN XI)',
            artery: 'Transverse cervical',
            actions: 'Upper: elevates. Middle: retracts. Lower: depresses scapula.',
            climbingCue: 'Pay attention to <strong>upper vs lower trap when reaching high</strong>. Avoid shrugging - keep shoulders down with lower trap.',
            climbingDetail: 'Upper trap often overactive. Lower trap crucial for keeping shoulders down during hangs.',
            clinical: 'CN XI damage causes shoulder droop, difficulty raising arm.'
        },
        {
            id: 'rhomboids',
            name: 'Rhomboids',
            latin: 'Mm. rhomboidei',
            region: 'Back',
            image: IMAGES.back,
            credit: 'TeachMeAnatomy',
            origin: 'C7-T5 spinous processes',
            insertion: 'Medial scapular border',
            nerve: 'Dorsal scapular (C5)',
            artery: 'Dorsal scapular',
            actions: 'Retracts and elevates scapula.',
            climbingCue: 'Pay attention to <strong>rhomboids when squeezing shoulder blades</strong>. Feel the squeeze between spine and scapulae during lock-offs.',
            climbingDetail: 'Critical for scapular stability. Weak rhomboids = winged scapulae, poor force transfer.',
            clinical: 'Dorsal scapular nerve entrapment: medial scapular pain.'
        },
        {
            id: 'serratus',
            name: 'Serratus Anterior',
            latin: 'M. serratus anterior',
            region: 'Thorax',
            image: IMAGES.back,
            credit: 'TeachMeAnatomy',
            origin: 'Ribs 1-8',
            insertion: 'Medial scapular border (anterior)',
            nerve: 'Long thoracic (C5-C7)',
            artery: 'Lateral thoracic',
            actions: 'Protracts scapula, upward rotation.',
            climbingCue: 'Pay attention to <strong>serratus when reaching far or mantling</strong>. Feel lateral rib activation as scapula pushes forward.',
            climbingDetail: 'Essential for overhead reaching and pressing. Works with trap for upward rotation.',
            clinical: 'Long thoracic nerve damage causes classic winged scapula.'
        },
        {
            id: 'lumbricals',
            name: 'Lumbricals',
            latin: 'Mm. lumbricales',
            region: 'Hand',
            image: IMAGES.hand,
            credit: 'Wikimedia Commons',
            origin: 'FDP tendons',
            insertion: 'Extensor expansions 2-5',
            nerve: 'Median (1-2), Ulnar (3-4)',
            artery: 'Superficial palmar arch',
            actions: 'Flex MCP while extending IP joints.',
            climbingCue: 'Pay attention to <strong>lumbricals on slopers and half-crimp</strong>. Allow nuanced positions between full crimp and open hand.',
            climbingDetail: 'Unique - originate from tendons. Essential for slopers and precision grips.',
            clinical: 'Lumbrical shift: pain when 2-finger pockets load unevenly.'
        },
        {
            id: 'triceps',
            name: 'Triceps Brachii',
            latin: 'M. triceps brachii',
            region: 'Arm',
            image: IMAGES.triceps,
            credit: 'TeachMeAnatomy',
            origin: 'Infraglenoid tubercle & posterior humerus',
            insertion: 'Olecranon',
            nerve: 'Radial (C6-C8)',
            artery: 'Deep brachial',
            actions: 'Extends elbow. Long head assists shoulder extension.',
            climbingCue: 'Pay attention to <strong>triceps during mantles</strong>. When you push down to top out, triceps extends elbow.',
            climbingDetail: 'Essential for mantling and press moves. Long head assists lats.',
            clinical: 'Radial nerve vulnerable in spiral groove - midshaft fracture = wrist drop.'
        }
    ];

    const app = {
        state: { currentIndex: 0, climbCount: 0, timerInterval: null, timerSeconds: 0, history: [] },

        init() {
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
        },

        getRandomIndex() {
            const available = [];
            for (let i = 0; i < ANATOMY_DB.length; i++) {
                if (!this.state.history.slice(-3).includes(i)) available.push(i);
            }
            return available.length ? available[Math.floor(Math.random() * available.length)] : Math.floor(Math.random() * ANATOMY_DB.length);
        },

        updateNextPreview() {
            const item = ANATOMY_DB[this.state.currentIndex];
            document.getElementById('next-muscle').textContent = item.name;
            document.getElementById('next-region').textContent = item.region;
        },

        showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        },

        startClimb() {
            const item = ANATOMY_DB[this.state.currentIndex];
            document.getElementById('preclimb-image').src = item.image;
            document.getElementById('preclimb-title').textContent = item.name;
            document.getElementById('preclimb-latin').textContent = item.latin;
            document.getElementById('preclimb-action').textContent = item.actions.split('.')[0];
            document.getElementById('preclimb-region').textContent = item.region;
            document.getElementById('preclimb-cue').innerHTML = item.climbingCue;
            this.showView('view-preclimb');
        },

        finishClimb() {
            this.populateRestView();
            this.startTimer();
            this.state.climbCount++;
            this.state.history.push(this.state.currentIndex);
            document.getElementById('climb-count').textContent = this.state.climbCount;
            this.showView('view-rest');
        },

        skipToRest() {
            this.populateRestView();
            this.startTimer();
            this.showView('view-rest');
        },

        populateRestView() {
            const item = ANATOMY_DB[this.state.currentIndex];
            document.getElementById('rest-image').src = item.image;
            document.getElementById('image-credit').textContent = 'Image: ' + item.credit;
            document.getElementById('rest-title').textContent = item.name;
            document.getElementById('rest-latin').textContent = item.latin;
            document.getElementById('rest-origin').textContent = item.origin;
            document.getElementById('rest-insertion').textContent = item.insertion;
            document.getElementById('rest-nerve').textContent = item.nerve;
            document.getElementById('rest-artery').textContent = item.artery;
            document.getElementById('rest-actions').textContent = item.actions;
            document.getElementById('rest-climbing').textContent = item.climbingDetail;
            document.getElementById('rest-clinical').textContent = item.clinical;
        },

        startTimer() {
            this.state.timerSeconds = 0;
            this.updateTimerDisplay();
            if (this.state.timerInterval) clearInterval(this.state.timerInterval);
            this.state.timerInterval = setInterval(() => { this.state.timerSeconds++; this.updateTimerDisplay(); }, 1000);
        },

        updateTimerDisplay() {
            const m = Math.floor(this.state.timerSeconds / 60);
            const s = this.state.timerSeconds % 60;
            document.getElementById('rest-timer').textContent = `${m}:${s.toString().padStart(2, '0')}`;
        },

        stopTimer() {
            if (this.state.timerInterval) { clearInterval(this.state.timerInterval); this.state.timerInterval = null; }
        },

        nextClimb() {
            this.stopTimer();
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
            this.startClimb();
        },

        goHome() {
            this.stopTimer();
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
            this.showView('view-home');
        }
    };

    document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
