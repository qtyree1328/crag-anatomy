<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CragAnatomy ‚Äî Learn While You Climb</title>
    <meta name="description" content="Study climbing-relevant anatomy during your rest periods. Learn muscle origins, insertions, and climbing applications.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Newsreader:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F6F3;
            --bg-warm: #FDF9F3;
            --surface: #FFFFFF;
            --text: #2D2A26;
            --text-secondary: #5C5752;
            --text-muted: #8A8580;
            
            /* Organic palette */
            --coral: #E8927C;
            --coral-soft: #FAE8E4;
            --sage: #7BA38F;
            --sage-soft: #E4F0E8;
            --sand: #D4C4A8;
            --sand-soft: #F5F0E6;
            --clay: #C49A6C;
            --sky: #8BAEC4;
            --sky-soft: #E4EEF4;
            
            --shadow-soft: 0 4px 20px rgba(45, 42, 38, 0.06);
            --shadow-medium: 0 8px 32px rgba(45, 42, 38, 0.1);
            
            --radius: 24px;
            --radius-lg: 32px;
            --radius-sm: 16px;
            
            --sans: 'Space Grotesk', system-ui, sans-serif;
            --serif: 'Newsreader', Georgia, serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            height: 100%;
            display: flex;
            flex-direction: column;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            background: var(--bg-warm);
        }

        /* Organic blob backgrounds */
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.5;
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }

        .blob-1 {
            width: 300px;
            height: 300px;
            background: var(--coral-soft);
            top: -100px;
            right: -100px;
            animation-delay: 0s;
        }

        .blob-2 {
            width: 250px;
            height: 250px;
            background: var(--sage-soft);
            bottom: 20%;
            left: -80px;
            animation-delay: -7s;
        }

        .blob-3 {
            width: 200px;
            height: 200px;
            background: var(--sky-soft);
            bottom: -50px;
            right: -50px;
            animation-delay: -14s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(10px, -15px) scale(1.02); }
            50% { transform: translate(-5px, 10px) scale(0.98); }
            75% { transform: translate(-15px, -5px) scale(1.01); }
        }

        /* Views */
        .view {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transform: translateY(16px);
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), 
                        visibility 0.5s;
        }

        .view.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Header */
        .header {
            padding: 20px 24px;
            padding-top: max(20px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .logo {
            font-family: var(--serif);
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.02em;
            color: var(--text);
        }

        .logo span {
            color: var(--coral);
        }

        .session-pill {
            background: var(--surface);
            border-radius: 999px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            box-shadow: var(--shadow-soft);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .session-pill strong {
            color: var(--coral);
            font-weight: 600;
        }

        /* Home View */
        .home-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0 24px 24px;
            overflow-y: auto;
            position: relative;
            z-index: 5;
        }

        .hero-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 0;
        }

        .hero-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--coral-soft) 0%, var(--sand-soft) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            font-size: 44px;
            box-shadow: var(--shadow-soft);
            position: relative;
        }

        .hero-icon::after {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 2px dashed var(--sand);
            opacity: 0.4;
            animation: spin 30s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hero-title {
            font-family: var(--serif);
            font-size: 32px;
            font-weight: 500;
            margin-bottom: 12px;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .hero-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            max-width: 280px;
            line-height: 1.5;
        }

        .climb-btn {
            width: 100%;
            padding: 22px 32px;
            background: linear-gradient(135deg, var(--coral) 0%, #D4765F 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(232, 146, 124, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .climb-btn:active {
            transform: scale(0.97);
            box-shadow: 0 4px 16px rgba(232, 146, 124, 0.35);
        }

        .next-card {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 20px;
            box-shadow: var(--shadow-soft);
        }

        .next-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .next-muscle {
            font-family: var(--serif);
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--text);
        }

        .next-region {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Pre-Climb View */
        .preclimb-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 5;
        }

        .back-btn {
            position: absolute;
            top: max(20px, env(safe-area-inset-top));
            left: 20px;
            width: 44px;
            height: 44px;
            background: var(--surface);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-soft);
            z-index: 20;
            font-size: 20px;
            color: var(--text);
            transition: transform 0.2s ease;
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        .preclimb-hero {
            padding: 80px 24px 32px;
            text-align: center;
            position: relative;
        }

        .focus-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--coral-soft);
            color: var(--coral);
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 16px;
        }

        .preclimb-title {
            font-family: var(--serif);
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .preclimb-latin {
            font-family: var(--serif);
            font-style: italic;
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .anatomy-image-wrap {
            background: linear-gradient(135deg, #f5f3f0 0%, #ebe7e2 100%);
            border-radius: var(--radius);
            padding: 16px;
            margin: 0 24px 24px;
            box-shadow: var(--shadow-soft);
        }

        .anatomy-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border-radius: var(--radius-sm);
        }

        .preclimb-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 0 24px;
            -webkit-overflow-scrolling: touch;
        }

        /* Climbing Cue Card - Main Focus */
        .cue-card {
            background: linear-gradient(135deg, var(--sage-soft) 0%, #D8EBE0 100%);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .cue-card::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: var(--sage);
            opacity: 0.1;
            border-radius: 50%;
        }

        .cue-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .cue-icon {
            width: 36px;
            height: 36px;
            background: var(--sage);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .cue-label {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--sage);
        }

        .cue-text {
            font-size: 17px;
            line-height: 1.55;
            color: var(--text);
            font-weight: 500;
        }

        .cue-text strong {
            color: var(--sage);
            font-weight: 600;
        }

        /* Quick Info Pills */
        .info-pills {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .info-pill {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 14px 18px;
            flex: 1;
            min-width: 140px;
            box-shadow: var(--shadow-soft);
        }

        .pill-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .pill-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .preclimb-footer {
            padding: 16px 24px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .finish-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--sage) 0%, #5E8A72 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(123, 163, 143, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .finish-btn:active {
            transform: scale(0.97);
        }

        /* Rest View */
        .rest-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 5;
            overflow: hidden;
        }

        .rest-header {
            background: linear-gradient(135deg, var(--sage-soft) 0%, #D8EBE0 100%);
            padding: 20px 24px;
            padding-top: max(20px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rest-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rest-dot {
            width: 12px;
            height: 12px;
            background: var(--sage);
            border-radius: 50%;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.15); }
        }

        .rest-label {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--sage);
        }

        .rest-timer {
            font-family: var(--sans);
            font-size: 24px;
            font-weight: 700;
            color: var(--sage);
            font-variant-numeric: tabular-nums;
        }

        .rest-scroll {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .rest-image-wrap {
            background: linear-gradient(135deg, #f5f3f0 0%, #ebe7e2 100%);
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rest-image {
            max-width: 100%;
            max-height: 220px;
            object-fit: contain;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-medium);
        }

        .image-credit {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 12px;
        }

        .rest-details {
            padding: 24px;
        }

        .rest-title {
            font-family: var(--serif);
            font-size: 26px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .rest-latin {
            font-family: var(--serif);
            font-style: italic;
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 24px;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .section-icon {
            width: 28px;
            height: 28px;
            background: var(--sand-soft);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .section-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            font-weight: 700;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .detail-card {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 16px;
            box-shadow: var(--shadow-soft);
        }

        .detail-card.full {
            grid-column: 1 / -1;
        }

        .detail-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .detail-value {
            font-size: 14px;
            color: var(--text);
            line-height: 1.5;
        }

        .highlight-card {
            background: linear-gradient(135deg, var(--coral-soft) 0%, #FCE4DF 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
        }

        .highlight-card .detail-label {
            color: var(--coral);
        }

        .clinical-card {
            background: linear-gradient(135deg, var(--sky-soft) 0%, #D6E8F2 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
        }

        .clinical-card .detail-label {
            color: var(--sky);
        }

        .rest-footer {
            padding: 16px 24px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            background: var(--bg-warm);
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .next-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--coral) 0%, #D4765F 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: var(--sans);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(232, 146, 124, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .next-btn:active {
            transform: scale(0.97);
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Organic blobs -->
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>

        <!-- Home View -->
        <div class="view active" id="view-home">
            <header class="header">
                <div class="logo">Crag<span>Anatomy</span></div>
                <div class="session-pill">
                    <span>üßó</span>
                    <span>Climbs: <strong id="climb-count">0</strong></span>
                </div>
            </header>
            
            <div class="home-content">
                <div class="hero-section">
                    <div class="hero-icon">ü¶¥</div>
                    <h1 class="hero-title">Ready to Climb?</h1>
                    <p class="hero-subtitle">Learn the anatomy that powers your movement during rest periods.</p>
                </div>
                
                <button class="climb-btn" onclick="app.startClimb()">
                    <span>Start Climb</span>
                    <span>‚Üí</span>
                </button>
                
                <div class="next-card">
                    <div class="next-label">Focus Area</div>
                    <div class="next-muscle" id="next-muscle">Loading...</div>
                    <div class="next-region" id="next-region"></div>
                </div>
            </div>
        </div>

        <!-- Pre-Climb View -->
        <div class="view" id="view-preclimb">
            <button class="back-btn" onclick="app.goHome()">‚Üê</button>
            
            <div class="preclimb-content">
                <div class="preclimb-hero">
                    <div class="focus-tag">
                        <span>üéØ</span>
                        <span>Focus Area</span>
                    </div>
                    <h1 class="preclimb-title" id="preclimb-title"></h1>
                    <p class="preclimb-latin" id="preclimb-latin"></p>
                </div>
                
                <div class="anatomy-image-wrap">
                    <img id="preclimb-image" class="anatomy-image" src="" alt="Anatomy illustration">
                </div>
                
                <div class="preclimb-scroll">
                    <div class="cue-card">
                        <div class="cue-header">
                            <div class="cue-icon">üí°</div>
                            <span class="cue-label">While You Climb</span>
                        </div>
                        <p class="cue-text" id="preclimb-cue"></p>
                    </div>
                    
                    <div class="info-pills">
                        <div class="info-pill">
                            <div class="pill-label">Primary Action</div>
                            <div class="pill-value" id="preclimb-action"></div>
                        </div>
                        <div class="info-pill">
                            <div class="pill-label">Region</div>
                            <div class="pill-value" id="preclimb-region"></div>
                        </div>
                    </div>
                </div>
                
                <div class="preclimb-footer">
                    <button class="finish-btn" onclick="app.finishClimb()">
                        <span>‚úì</span>
                        <span>Finish Climb & Learn More</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Rest View -->
        <div class="view" id="view-rest">
            <div class="rest-content">
                <div class="rest-header">
                    <div class="rest-status">
                        <div class="rest-dot"></div>
                        <span class="rest-label">Rest & Learn</span>
                    </div>
                    <div class="rest-timer" id="rest-timer">0:00</div>
                </div>
                
                <div class="rest-scroll">
                    <div class="rest-image-wrap">
                        <img id="rest-image" class="rest-image" src="" alt="Anatomy illustration">
                        <div class="image-credit" id="image-credit"></div>
                    </div>
                    
                    <div class="rest-details">
                        <h2 class="rest-title" id="rest-title"></h2>
                        <p class="rest-latin" id="rest-latin"></p>
                        
                        <div class="detail-section">
                            <div class="section-header">
                                <div class="section-icon">üìç</div>
                                <span class="section-title">Attachments</span>
                            </div>
                            <div class="detail-grid">
                                <div class="detail-card">
                                    <div class="detail-label">Origin</div>
                                    <div class="detail-value" id="rest-origin"></div>
                                </div>
                                <div class="detail-card">
                                    <div class="detail-label">Insertion</div>
                                    <div class="detail-value" id="rest-insertion"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="section-header">
                                <div class="section-icon">‚ö°</div>
                                <span class="section-title">Innervation & Supply</span>
                            </div>
                            <div class="detail-grid">
                                <div class="detail-card">
                                    <div class="detail-label">Nerve</div>
                                    <div class="detail-value" id="rest-nerve"></div>
                                </div>
                                <div class="detail-card">
                                    <div class="detail-label">Artery</div>
                                    <div class="detail-value" id="rest-artery"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="section-header">
                                <div class="section-icon">üéØ</div>
                                <span class="section-title">Function</span>
                            </div>
                            <div class="detail-card full">
                                <div class="detail-label">Actions</div>
                                <div class="detail-value" id="rest-actions"></div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="section-header">
                                <div class="section-icon">üßó</div>
                                <span class="section-title">Climbing Application</span>
                            </div>
                            <div class="highlight-card">
                                <div class="detail-label">Why Climbers Care</div>
                                <div class="detail-value" id="rest-climbing"></div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="section-header">
                                <div class="section-icon">‚ö†Ô∏è</div>
                                <span class="section-title">Clinical Note</span>
                            </div>
                            <div class="clinical-card">
                                <div class="detail-label">Common Injury / Pathology</div>
                                <div class="detail-value" id="rest-clinical"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rest-footer">
                    <button class="next-btn" onclick="app.nextClimb()">
                        <span>üßó</span>
                        <span>Next Climb</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Comprehensive anatomy database with actionable climbing cues
    const ANATOMY_DB = [
        {
            id: 'fdp',
            name: 'Flexor Digitorum Profundus',
            latin: 'Musculus flexor digitorum profundus',
            region: 'Forearm (Deep Anterior)',
            origin: 'Proximal 3/4 of anterior and medial surfaces of ulna, interosseous membrane',
            insertion: 'Palmar surfaces of bases of distal phalanges of digits 2-5',
            nerve: 'Median nerve (AIN for digits 2-3), Ulnar nerve (digits 4-5)',
            artery: 'Anterior interosseous artery',
            actions: 'Flexion of distal interphalangeal joints of digits 2-5. Assists in flexion of PIP, MCP, and wrist.',
            climbingCue: 'Pay attention to <strong>FDP engagement when crimping</strong>. Feel the deep forearm burn as you curl your fingertips onto small edges. This is the ONLY muscle that can flex your DIP joints.',
            climbingDetail: 'This is the primary crimp muscle. When you curl your fingertips on a hold, FDP is doing the heavy lifting. It\'s also the origin point for the lumbrical muscles, which are crucial for open-hand grips.',
            clinical: 'Lumbrical Shift Syndrome: When pulling hard on 1-2 fingers (pockets), the lumbrical muscle can get caught between FDP tendons, causing sharp palm pain.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/4/4e/Gray417.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'fds',
            name: 'Flexor Digitorum Superficialis',
            latin: 'Musculus flexor digitorum superficialis',
            region: 'Forearm (Intermediate)',
            origin: 'Medial epicondyle, coronoid process of ulna, anterior radius',
            insertion: 'Sides of middle phalanges of digits 2-5',
            nerve: 'Median nerve (C7, C8, T1)',
            artery: 'Ulnar artery, radial artery',
            actions: 'Flexion of PIP joints of digits 2-5. Assists in MCP flexion and wrist flexion.',
            climbingCue: 'Pay attention to <strong>FDS on slopers and open-hand grips</strong>. When you curve your middle knuckles without crimping tight, FDS is the prime mover. Feel the mid-forearm activation.',
            climbingDetail: 'Works in tandem with FDP for grip strength. On slopers and larger holds where you use an open-hand grip, FDS takes more of the load. The split insertion allows FDP tendons to pass through.',
            clinical: 'Tenosynovitis of FDS tendons can cause trigger finger. Test FDS isolation by holding other fingers extended while flexing one PIP.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/2/23/Gray416.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'pulleys',
            name: 'Annular Pulleys (A2 & A4)',
            latin: 'Pars anularis vaginae fibrosae',
            region: 'Hand (Finger)',
            origin: 'Periosteum of proximal phalanx (A2) and middle phalanx (A4)',
            insertion: 'Wraps around flexor tendon sheath, forming a ring',
            nerve: 'N/A (connective tissue)',
            artery: 'Digital arteries',
            actions: 'Hold flexor tendons close to the phalanges, preventing bowstringing.',
            climbingCue: 'Pay attention to <strong>pulley stress when full crimping</strong>. Feel the pressure at the base of your fingers. Consider using half-crimp or open-hand to reduce A2 strain.',
            climbingDetail: 'A2 pulley at the base of the proximal phalanx is the most commonly injured structure in climbing. Full crimping creates massive force vectors pulling the tendon away from bone.',
            clinical: 'A2 rupture = popping sound, swelling, bowstringing. Prevention: avoid full crimps when fatigued. Treatment: rest, ring splinting, possible surgery.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/e/ed/Gray423.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'lat',
            name: 'Latissimus Dorsi',
            latin: 'Musculus latissimus dorsi',
            region: 'Back (Superficial)',
            origin: 'Spinous processes T7-L5, thoracolumbar fascia, iliac crest, ribs 9-12',
            insertion: 'Floor of intertubercular groove of humerus',
            nerve: 'Thoracodorsal nerve (C6, C7, C8)',
            artery: 'Thoracodorsal artery',
            actions: 'Extension, adduction, and medial rotation of arm. Depression of scapula.',
            climbingCue: 'Pay attention to <strong>lat engagement during every pull-down</strong>. Initiate pulls by depressing your shoulder and engaging your "wings." Feel the connection from hands to hips on steep terrain.',
            climbingDetail: 'The primary pulling muscle. Every pull-down engages the lats. On overhangs, they work overtime. Strong lats reduce load on smaller, injury-prone structures.',
            clinical: 'Lat tightness limits overhead mobility and can cause shoulder impingement. Compensatory lumbar hyperextension occurs when reaching high with tight lats.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/6/6b/Latissimus_dorsi.PNG',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'brachialis',
            name: 'Brachialis',
            latin: 'Musculus brachialis',
            region: 'Arm (Anterior)',
            origin: 'Distal half of anterior surface of humerus',
            insertion: 'Coronoid process and tuberosity of ulna',
            nerve: 'Musculocutaneous nerve (C5, C6)',
            artery: 'Brachial artery, radial recurrent artery',
            actions: 'Flexion of forearm at elbow (primary flexor regardless of forearm position).',
            climbingCue: 'Pay attention to <strong>brachialis during lock-offs</strong>. Unlike biceps, it works equally palms-up, down, or neutral. Feel the deep anterior arm engagement during sustained bent-arm positions.',
            climbingDetail: 'More important than biceps for climbing! Brachialis is the pure elbow flexor - position-independent. Every lock-off, every pull-up, brachialis is the workhorse.',
            clinical: 'Brachialis tendinopathy causes deep anterior elbow pain, often misdiagnosed as biceps issues. Forms the floor of the cubital fossa.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/e/ee/Gray411.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'biceps',
            name: 'Biceps Brachii',
            latin: 'Musculus biceps brachii',
            region: 'Arm (Anterior)',
            origin: 'Long head: supraglenoid tubercle. Short head: coracoid process',
            insertion: 'Radial tuberosity and bicipital aponeurosis',
            nerve: 'Musculocutaneous nerve (C5, C6)',
            artery: 'Brachial artery',
            actions: 'Supination of forearm (strongest), flexion of forearm, assists shoulder flexion.',
            climbingCue: 'Pay attention to <strong>biceps during sidepulls and underlings</strong>. The biceps is actually your strongest supinator. Feel it fire when you twist your palm up on a sidepull or underling.',
            climbingDetail: 'While famous, biceps is secondary to brachialis for pure flexion. However, its supination power is crucial for sidepulls and underlings where forearm rotation matters.',
            clinical: 'Long head biceps tendinopathy: anterior shoulder pain with overhead reaching. "Popeye deformity" indicates rupture.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/c/c0/Gray410.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'supraspinatus',
            name: 'Supraspinatus',
            latin: 'Musculus supraspinatus',
            region: 'Shoulder (Rotator Cuff)',
            origin: 'Supraspinous fossa of scapula',
            insertion: 'Superior facet of greater tubercle of humerus',
            nerve: 'Suprascapular nerve (C5, C6)',
            artery: 'Suprascapular artery',
            actions: 'Initiates abduction of arm (first 15¬∞), stabilizes glenohumeral joint.',
            climbingCue: 'Pay attention to <strong>supraspinatus when initiating reaches</strong>. It fires to start every reach and keeps your humeral head centered in the socket during dynamic moves.',
            climbingDetail: 'Critical for dynamic moves and shoulder stability. The tendon passes through the narrow subacromial space - vulnerable to impingement with poor scapular mechanics.',
            clinical: 'Most commonly torn rotator cuff muscle. "Empty can test" for assessment. Impingement common in climbers lacking thoracic mobility.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/d/da/Supraspinatus_muscle_back4.png',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'infraspinatus',
            name: 'Infraspinatus',
            latin: 'Musculus infraspinatus',
            region: 'Shoulder (Rotator Cuff)',
            origin: 'Infraspinous fossa of scapula',
            insertion: 'Middle facet of greater tubercle of humerus',
            nerve: 'Suprascapular nerve (C5, C6)',
            artery: 'Suprascapular and circumflex scapular arteries',
            actions: 'Lateral (external) rotation of arm, stabilizes glenohumeral joint.',
            climbingCue: 'Pay attention to <strong>infraspinatus during gastons</strong>. When you push outward on a sidepull, external rotation engages infraspinatus. Also fires to decelerate dynamic moves.',
            climbingDetail: 'Essential for gastons and any external rotation move. Often weak and overpowered by internal rotators in climbers. Critical for deceleration during dynos.',
            clinical: 'Spinoglenoid notch ganglion cysts can selectively affect infraspinatus while sparing supraspinatus.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/f/f1/Infraspinatus_muscle_back3.png',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'levator_trap',
            name: 'Levator Scapulae & Upper Trapezius',
            latin: 'M. levator scapulae et trapezius superior',
            region: 'Neck/Shoulder',
            origin: 'Levator: C1-C4 transverse processes. Upper trap: skull base, ligamentum nuchae',
            insertion: 'Levator: superior medial scapula. Upper trap: lateral clavicle, acromion',
            nerve: 'Levator: dorsal scapular (C5), C3-C4. Trap: spinal accessory (CN XI)',
            artery: 'Dorsal scapular, transverse cervical arteries',
            actions: 'Elevation of scapula (shrugging). Levator also downwardly rotates. Upper trap assists upward rotation.',
            climbingCue: 'Pay attention to <strong>levator and upper trap when reaching for high holds</strong>. Avoid shrugging - keep shoulders down! Excessive elevation indicates poor scapular control.',
            climbingDetail: 'Often overactive in climbers, causing neck tension and imbalanced scapular mechanics. The goal is to use these muscles appropriately without over-relying on shrugging.',
            clinical: 'Chronic neck/shoulder tension often involves hypertonic levator and upper trap. Dorsal scapular nerve entrapment causes medial scapular pain.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/2/23/Muscles_posterior.png',
            imageCredit: 'Mikael H√§ggstr√∂m, Public Domain'
        },
        {
            id: 'rhomboids',
            name: 'Rhomboid Major & Minor',
            latin: 'Musculi rhomboidei',
            region: 'Back (Deep)',
            origin: 'Minor: ligamentum nuchae, C7-T1. Major: spinous processes T2-T5',
            insertion: 'Medial border of scapula',
            nerve: 'Dorsal scapular nerve (C5)',
            artery: 'Dorsal scapular artery',
            actions: 'Retraction of scapula, elevation, downward rotation of glenoid.',
            climbingCue: 'Pay attention to <strong>rhomboids when squeezing shoulder blades together</strong>. At the bottom of a pull or during a lock-off, feel the squeeze between your spine and scapulae.',
            climbingDetail: 'Critical for scapular stability and proper pulling mechanics. Weak rhomboids lead to "winged" scapulae and poor force transfer during pulls.',
            clinical: 'Dorsal scapular nerve entrapment through middle scalene causes medial scapular pain, often misdiagnosed as cervical radiculopathy.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/9/9a/Rhomboideus_major.png',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'serratus',
            name: 'Serratus Anterior',
            latin: 'Musculus serratus anterior',
            region: 'Thorax (Lateral)',
            origin: 'External surfaces of ribs 1-8',
            insertion: 'Anterior surface of medial border of scapula',
            nerve: 'Long thoracic nerve (C5, C6, C7)',
            artery: 'Lateral thoracic artery',
            actions: 'Protraction of scapula, upward rotation of glenoid, holds scapula to thorax.',
            climbingCue: 'Pay attention to <strong>serratus when reaching far or mantling</strong>. Feel the lateral rib activation as you push your scapula forward. Essential for pressing out over a ledge.',
            climbingDetail: 'Essential for overhead reaching and pressing movements. Keeps the scapula stable against the ribcage. Works with trapezius for upward rotation during reaches.',
            clinical: 'Long thoracic nerve damage causes classic winged scapula visible when pushing against a wall. Recovery can take months.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/c/c4/Serratus_anterior.png',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'lumbricals',
            name: 'Lumbrical Muscles',
            latin: 'Musculi lumbricales manus',
            region: 'Hand (Intrinsic)',
            origin: 'Tendons of flexor digitorum profundus',
            insertion: 'Lateral sides of extensor expansions, digits 2-5',
            nerve: 'Lateral two: median. Medial two: ulnar (deep branch)',
            artery: 'Superficial palmar arch',
            actions: 'Flex MCP joints while extending IP joints (intrinsic plus position).',
            climbingCue: 'Pay attention to <strong>lumbricals on slopers and during half-crimp</strong>. They allow the nuanced finger position between full crimp and open hand. Feel the palm engagement.',
            climbingDetail: 'Unique because they originate from tendons, not bone. Essential for slopers and precision grips. Work with interossei for fine motor control.',
            clinical: 'Lumbrical shift injury: in 2-finger pockets, differential loading catches the lumbrical between FDP tendons causing acute palm pain.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/b/bb/Gray420.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'interossei',
            name: 'Interossei (Dorsal & Palmar)',
            latin: 'Musculi interossei',
            region: 'Hand (Intrinsic)',
            origin: 'Dorsal: adjacent metacarpals. Palmar: metacarpals 2, 4, 5',
            insertion: 'Proximal phalanx bases and extensor expansions',
            nerve: 'Ulnar nerve, deep branch (C8, T1)',
            artery: 'Deep palmar arch',
            actions: 'DAB: Dorsal ABduct. PAD: Palmar ADduct. Both flex MCP, extend IP.',
            climbingCue: 'Pay attention to <strong>interossei during pinch grips</strong>. The adductors squeeze your fingers together; the abductors spread them on volumes. Feel the hand intrinsic engagement.',
            climbingDetail: 'Critical for pinch grips (adduction) and spreading fingers on volumes (abduction). Work with lumbricals for the intrinsic plus position.',
            clinical: 'Ulnar nerve lesion causes interosseous weakness: Froment\'s sign (compensatory thumb flexion during pinch).',
            image: 'https://upload.wikimedia.org/wikipedia/commons/2/2f/Gray428.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        },
        {
            id: 'lower_trap',
            name: 'Lower Trapezius',
            latin: 'Trapezius pars ascendens',
            region: 'Back (Superficial)',
            origin: 'Spinous processes T4-T12',
            insertion: 'Medial end of spine of scapula',
            nerve: 'Spinal accessory (CN XI) for motor; C3-C4 proprioception',
            artery: 'Transverse cervical artery',
            actions: 'Depression of scapula, assists upward rotation of glenoid.',
            climbingCue: 'Pay attention to <strong>lower trap when dead hanging or reaching overhead</strong>. It pulls your shoulder blades DOWN. Engage it to avoid shrugging and maintain proper shoulder position.',
            climbingDetail: 'Often weak and neglected in climbers while upper trap is overactive. Lower trap strength is crucial for keeping shoulders down during hangs and overhead reaches.',
            clinical: 'Weakness contributes to scapular dyskinesis and shoulder impingement. Training lower trap helps balance the upper trap dominance common in climbers.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/2/23/Muscles_posterior.png',
            imageCredit: 'Mikael H√§ggstr√∂m, Public Domain'
        },
        {
            id: 'triceps',
            name: 'Triceps Brachii',
            latin: 'Musculus triceps brachii',
            region: 'Arm (Posterior)',
            origin: 'Long head: infraglenoid tubercle. Lateral: above radial groove. Medial: below radial groove',
            insertion: 'Olecranon process of ulna',
            nerve: 'Radial nerve (C6, C7, C8)',
            artery: 'Deep brachial artery',
            actions: 'Extension of forearm. Long head assists shoulder extension and adduction.',
            climbingCue: 'Pay attention to <strong>triceps during mantles and press moves</strong>. When you push down to top out or press over a ledge, triceps extends your elbow. Feel the posterior arm engagement.',
            climbingDetail: 'Essential for mantling, press moves, and controlling descent. The long head also assists lats in shoulder extension. Often neglected by climbers who focus only on pulling.',
            clinical: 'Radial nerve in spiral groove is vulnerable to midshaft humeral fractures - causing wrist drop.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/8/8c/Triceps_brachii.png',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'subscapularis',
            name: 'Subscapularis',
            latin: 'Musculus subscapularis',
            region: 'Shoulder (Rotator Cuff)',
            origin: 'Subscapular fossa (anterior scapula)',
            insertion: 'Lesser tubercle of humerus',
            nerve: 'Upper and lower subscapular nerves (C5, C6, C7)',
            artery: 'Subscapular artery',
            actions: 'Medial (internal) rotation of arm, adduction, anterior GH stabilization.',
            climbingCue: 'Pay attention to <strong>subscapularis during cross-body moves and compression</strong>. Internal rotation power comes from subscap. It also prevents your shoulder from dislocating anteriorly.',
            climbingDetail: 'The largest rotator cuff muscle. Provides anterior stability and powers internal rotation. Often tight in climbers, limiting external rotation mobility.',
            clinical: 'Tested with lift-off test (Gerber). Tears cause internal rotation weakness and anterior instability.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/a/a0/Subscapularis.png',
            imageCredit: 'Anatomography, CC BY-SA 2.1 JP'
        },
        {
            id: 'extensors',
            name: 'Forearm Extensors',
            latin: 'Musculi extensores antebrachii',
            region: 'Forearm (Posterior)',
            origin: 'Lateral epicondyle (common extensor origin) and posterior forearm',
            insertion: 'Dorsal hand, fingers, and thumb',
            nerve: 'Radial nerve and posterior interosseous nerve',
            artery: 'Posterior interosseous artery',
            actions: 'Extension of wrist and fingers. ECRL/ECRB extend and abduct wrist.',
            climbingCue: 'Pay attention to <strong>extensors for wrist stability</strong>. They hold your wrist slightly extended so flexors work optimally. Feel the back of your forearm engage when you open your hand.',
            climbingDetail: 'Often overlooked but crucial. Extensors stabilize the wrist and allow you to open your hand quickly to grab the next hold. Balance with flexor training.',
            clinical: 'Lateral epicondylitis (tennis elbow) affects the common extensor origin. Common from repetitive gripping.',
            image: 'https://upload.wikimedia.org/wikipedia/commons/0/08/Gray419.png',
            imageCredit: 'Gray\'s Anatomy, Public Domain'
        }
    ];

    // App controller
    const app = {
        state: {
            currentIndex: 0,
            climbCount: 0,
            timerInterval: null,
            timerSeconds: 0,
            history: []
        },

        init() {
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
        },

        getRandomIndex() {
            const available = [];
            for (let i = 0; i < ANATOMY_DB.length; i++) {
                if (!this.state.history.slice(-4).includes(i)) {
                    available.push(i);
                }
            }
            if (available.length === 0) {
                available.push(...Array.from({length: ANATOMY_DB.length}, (_, i) => i));
            }
            return available[Math.floor(Math.random() * available.length)];
        },

        updateNextPreview() {
            const item = ANATOMY_DB[this.state.currentIndex];
            document.getElementById('next-muscle').textContent = item.name;
            document.getElementById('next-region').textContent = item.region;
        },

        showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        },

        startClimb() {
            const item = ANATOMY_DB[this.state.currentIndex];
            
            document.getElementById('preclimb-image').src = item.image;
            document.getElementById('preclimb-title').textContent = item.name;
            document.getElementById('preclimb-latin').textContent = item.latin;
            document.getElementById('preclimb-action').textContent = item.actions.split('.')[0];
            document.getElementById('preclimb-region').textContent = item.region;
            document.getElementById('preclimb-cue').innerHTML = item.climbingCue;
            
            this.showView('view-preclimb');
        },

        finishClimb() {
            const item = ANATOMY_DB[this.state.currentIndex];
            
            document.getElementById('rest-image').src = item.image;
            document.getElementById('rest-title').textContent = item.name;
            document.getElementById('rest-latin').textContent = item.latin;
            document.getElementById('rest-origin').textContent = item.origin;
            document.getElementById('rest-insertion').textContent = item.insertion;
            document.getElementById('rest-nerve').textContent = item.nerve;
            document.getElementById('rest-artery').textContent = item.artery;
            document.getElementById('rest-actions').textContent = item.actions;
            document.getElementById('rest-climbing').textContent = item.climbingDetail;
            document.getElementById('rest-clinical').textContent = item.clinical;
            document.getElementById('image-credit').textContent = item.imageCredit;
            
            this.startTimer();
            
            this.state.climbCount++;
            this.state.history.push(this.state.currentIndex);
            document.getElementById('climb-count').textContent = this.state.climbCount;
            
            this.showView('view-rest');
        },

        startTimer() {
            this.state.timerSeconds = 0;
            this.updateTimerDisplay();
            
            if (this.state.timerInterval) clearInterval(this.state.timerInterval);
            
            this.state.timerInterval = setInterval(() => {
                this.state.timerSeconds++;
                this.updateTimerDisplay();
            }, 1000);
        },

        updateTimerDisplay() {
            const mins = Math.floor(this.state.timerSeconds / 60);
            const secs = this.state.timerSeconds % 60;
            document.getElementById('rest-timer').textContent = 
                `${mins}:${secs.toString().padStart(2, '0')}`;
        },

        stopTimer() {
            if (this.state.timerInterval) {
                clearInterval(this.state.timerInterval);
                this.state.timerInterval = null;
            }
        },

        nextClimb() {
            this.stopTimer();
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
            this.startClimb();
        },

        goHome() {
            this.stopTimer();
            this.state.currentIndex = this.getRandomIndex();
            this.updateNextPreview();
            this.showView('view-home');
        }
    };

    document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
